/* tslint:disable:no-string-literal */
import { ResourceUtils } from '../util/resource.utils';
import { isArray, isEmpty, isNull, isUndefined } from 'lodash-es';
import { Resource } from './resource/resource';
import { EmbeddedResource } from './resource/embedded-resource';
import { DEFAULT_ROUTE_NAME } from '../config/hateoas-configuration.interface';
import { RESOURCE_NAME_PROP, RESOURCE_OPTIONS_PROP } from './declarations';
/**
 * Decorator used to classes that extend {@link Resource} class to register 'resourceName' and 'resourceType'
 * information about this resource.
 *
 * @param resourceName resource name which will be used to build a resource URL.
 * @param options additional resource options. See more {@link ResourceOption}.
 */
export function HateoasResource(resourceName, options = { routeName: DEFAULT_ROUTE_NAME }) {
    return (constructor) => {
        if (isNull(resourceName) || isUndefined(resourceName) || !resourceName) {
            throw new Error(`Init resource '${constructor.name}' error. @HateoasResource decorator param resourceName can not be null/undefined/empty, please pass a valid resourceName.`);
        }
        if (!isInstanceOfParent(constructor, Resource)) {
            throw new Error(`Init resource '${constructor.name}' error. @HateoasResource decorator applied only to 'Resource' type, you used it with ${Object.getPrototypeOf(constructor)} type.`);
        }
        constructor[RESOURCE_NAME_PROP] = resourceName;
        ResourceUtils.RESOURCE_NAME_TYPE_MAP.set(resourceName.toLowerCase(), constructor);
        if (!options?.routeName) {
            options = {
                routeName: DEFAULT_ROUTE_NAME
            };
        }
        constructor[RESOURCE_OPTIONS_PROP] = options;
        return constructor;
    };
}
/**
 * Decorator used to classes that extend {@link EmbeddedResource} class to register 'relationNames' and 'resourceType'
 * information about this resource.
 *
 * @param relationNames names of the properties that using to hold this embedded resource in resource objects.
 */
export function HateoasEmbeddedResource(relationNames) {
    return (constructor) => {
        if (isNull(relationNames)
            || isUndefined(relationNames)
            || (isArray(relationNames) && isEmpty(relationNames))) {
            throw new Error(`Init resource '${constructor.name}' error. @HateoasEmbeddedResource decorator param relationNames can not be null/undefined/empty, please pass a valid relationNames.`);
        }
        if (!isInstanceOfParent(constructor, EmbeddedResource)) {
            throw new Error(`Init resource '${constructor.name}' error. @HateoasEmbeddedResource decorator applied only to 'EmbeddedResource' type, you used it with ${Object.getPrototypeOf(constructor)} type.`);
        }
        relationNames.forEach(relationName => {
            ResourceUtils.EMBEDDED_RESOURCE_TYPE_MAP.set(relationName, constructor);
        });
    };
}
/**
 * Decorator used to create a projection representation of {@link Resource} heirs.
 *
 * @param resourceType type of resource that using for projection.
 * @param projectionName name of projection, will be used as projection request param.
 */
export function HateoasProjection(resourceType, projectionName) {
    return (constructor) => {
        if (isNull(resourceType) || isUndefined(resourceType)) {
            throw new Error(`Init resource projection '${constructor.name}' error. @HateoasProjection decorator param resourceType can not be null/undefined, please pass a valid resourceType.`);
        }
        if (isNull(projectionName) || isUndefined(projectionName) || !projectionName) {
            throw new Error(`Init resource projection '${constructor.name}' error. @HateoasProjection decorator param projectionName can not be null/undefined/empty, please pass a valid projectionName.`);
        }
        if (!isInstanceOfParent(constructor, Resource)) {
            throw new Error(`Init resource projection '${constructor.name}' error. @HateoasProjection decorator applied only to 'Resource' type, you used it with ${Object.getPrototypeOf(constructor)} type.`);
        }
        constructor[RESOURCE_NAME_PROP] = resourceType[RESOURCE_NAME_PROP];
        constructor[RESOURCE_OPTIONS_PROP] = resourceType[RESOURCE_OPTIONS_PROP];
        constructor['__projectionName__'] = projectionName;
        ResourceUtils.RESOURCE_NAME_PROJECTION_TYPE_MAP.set(resourceType[RESOURCE_NAME_PROP].toLowerCase(), constructor);
        return constructor;
    };
}
/**
 * Decorator used to mark projection class properties that are resources and specifying class type used to create this relation.
 * This decorator used with class marked as {@link HateoasProjection}.
 *
 * @param relationType resource relation type that will be used to create resource with this type when parsed server response.
 */
export function ProjectionRel(relationType) {
    return (target, propertyKey) => {
        if (isNull(relationType) || isUndefined(relationType)) {
            throw new Error(`Init resource projection '${target.constructor.name}' relation type error. @ProjectionRel decorator param relationType can not be null/undefined, please pass a valid relationType.`);
        }
        ResourceUtils.RESOURCE_PROJECTION_REL_NAME_TYPE_MAP.set(propertyKey, relationType);
    };
}
function isInstanceOfParent(constructor, parentClass) {
    if (Object.getPrototypeOf(constructor).name === '') {
        return false;
    }
    if (Object.getPrototypeOf(constructor) === parentClass) {
        return true;
    }
    return isInstanceOfParent(Object.getPrototypeOf(constructor), parentClass);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjb3JhdG9ycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1oYXRlb2FzLWNsaWVudC9zcmMvbGliL21vZGVsL2RlY29yYXRvcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsc0NBQXNDO0FBQ3RDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN2RCxPQUFPLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ2xFLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUMvQyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUVoRSxPQUFPLEVBQUUsa0JBQWtCLEVBQWtCLE1BQU0sMkNBQTJDLENBQUM7QUFDL0YsT0FBTyxFQUFFLGtCQUFrQixFQUFFLHFCQUFxQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFHM0U7Ozs7OztHQU1HO0FBQ0gsTUFBTSxVQUFVLGVBQWUsQ0FBQyxZQUFvQixFQUFFLFVBQTBCLEVBQUMsU0FBUyxFQUFFLGtCQUFrQixFQUFDO0lBQzdHLE9BQU8sQ0FBdUMsV0FBYyxFQUFFLEVBQUU7UUFDOUQsSUFBSSxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksV0FBVyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ3RFLE1BQU0sSUFBSSxLQUFLLENBQUMsa0JBQW1CLFdBQVcsQ0FBQyxJQUFLLDJIQUEySCxDQUFDLENBQUM7U0FDbEw7UUFFRCxJQUFJLENBQUMsa0JBQWtCLENBQUMsV0FBVyxFQUFFLFFBQVEsQ0FBQyxFQUFFO1lBQzlDLE1BQU0sSUFBSSxLQUFLLENBQUMsa0JBQW1CLFdBQVcsQ0FBQyxJQUFLLHlGQUEwRixNQUFNLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBRSxRQUFRLENBQUMsQ0FBQztTQUM1TDtR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QzdDLElBQUksTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLFdBQVcsQ0FBQyxZQUFZLENBQUMsRUFBRTtZQUNyRCxNQUFNLElBQUksS0FBSyxDQUFDLDZCQUE4QixNQUFNLENBQUMsV0FBVyxDQUFDLElBQUssaUlBQWlJLENBQUMsQ0FBQztTQUMxTTtRQUVELGFBQWEsQ0FBQyxxQ0FBcUMsQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQ3JGLENBQUMsQ0FBQztBQUNKLENBQUM7QUFHRCxTQUFTLGtCQUFrQixDQUFDLFdBQXdDLEVBQUUsV0FBZ0I7SUFDcEYsSUFBSSxNQUFNLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksS0FBSyxFQUFFLEVBQUU7UUFDbEQsT0FBTyxLQUFLLENBQUM7S0FDZDtJQUNELElBQUksTUFBTSxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsS0FBSyxXQUFXLEVBQUU7UUFDdEQsT0FBTyxJQUFJLENBQUM7S0FDYjtJQUVELE9BQU8sa0JBQWtCLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsRUFBRSxXQUFXLENBQUMsQ0FBQztBQUM3RSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyogdHNsaW50OmRpc2FibGU6bm8tc3RyaW5nLWxpdGVyYWwgKi9cbmltcG9ydCB7IFJlc291cmNlVXRpbHMgfSBmcm9tICcuLi91dGlsL3Jlc291cmNlLnV0aWxzJztcbmltcG9ydCB7IGlzQXJyYXksIGlzRW1wdHksIGlzTnVsbCwgaXNVbmRlZmluZWQgfSBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHsgUmVzb3VyY2UgfSBmcm9tICcuL3Jlc291cmNlL3Jlc291cmNlJztcbmltcG9ydCB7IEVtYmVkZGVkUmVzb3VyY2UgfSBmcm9tICcuL3Jlc291cmNlL2VtYmVkZGVkLXJlc291cmNlJztcbmltcG9ydCB7IEJhc2VSZXNvdXJjZSB9IGZyb20gJy4vcmVzb3VyY2UvYmFzZS1yZXNvdXJjZSc7XG5pbXBvcnQgeyBERUZBVUxUX1JPVVRFX05BTUUsIFJlc291cmNlT3B0aW9uIH0gZnJvbSAnLi4vY29uZmlnL2hhdGVvYXMtY29uZmlndXJhdGlvbi5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUkVTT1VSQ0VfTkFNRV9QUk9QLCBSRVNPVVJDRV9PUFRJT05TX1BST1AgfSBmcm9tICcuL2RlY2xhcmF0aW9ucyc7XG5cblxuLyoqXG4gKiBEZWNvcmF0b3IgdXNlZCB0byBjbGFzc2VzIHRoYXQgZXh0ZW5kIHtAbGluayBSZXNvdXJjZX0gY2xhc3MgdG8gcmVnaXN0ZXIgJ3Jlc291cmNlTmFtZScgYW5kICdyZXNvdXJjZVR5cGUnXG4gKiBpbmZvcm1hdGlvbiBhYm91dCB0aGlzIHJlc291cmNlLlxuICpcbiAqIEBwYXJhbSByZXNvdXJjZU5hbWUgcmVzb3VyY2UgbmFtZSB3aGljaCB3aWxsIGJlIHVzZWQgdG8gYnVpbGQgYSByZXNvdXJjZSBVUkwuXG4gKiBAcGFyYW0gb3B0aW9ucyBhZGRpdGlvbmFsIHJlc291cmNlIG9wdGlvbnMuIFNlZSBtb3JlIHtAbGluayBSZXNvdXJjZU9wdGlvbn0uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBIYXRlb2FzUmVzb3VyY2UocmVzb3VyY2VOYW1lOiBzdHJpbmcsIG9wdGlvbnM6IFJlc291cmNlT3B0aW9uID0ge3JvdXRlTmFtZTogREVGQVVMVF9ST1VURV9OQU1FfSkge1xuICByZXR1cm4gPFQgZXh0ZW5kcyBuZXcoLi4uYXJnczogYW55W10pID0+IGFueT4oY29uc3RydWN0b3I6IFQpID0+IHtcbiAgICBpZiAoaXNOdWxsKHJlc291cmNlTmFtZSkgfHwgaXNVbmRlZmluZWQocmVzb3VyY2VOYW1lKSB8fCAhcmVzb3VyY2VOYW1lKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEluaXQgcmVzb3VyY2UgJyR7IGNvbnN0cnVjdG9yLm5hbWUgfScgZXJyb3IuIEBIYXRlb2FzUmVzb3VyY2UgZGVjb3JhdG9yIHBhcmFtIHJlc291cmNlTmFtZSBjYW4gbm90IGJlIG51bGwvdW5kZWZpbmVkL2VtcHR5LCBwbGVhc2UgcGFzcyBhIHZhbGlkIHJlc291cmNlTmFtZS5gKTtcbiAgICB9XG5cbiAgICBpZiAoIWlzSW5zdGFuY2VPZlBhcmVudChjb25zdHJ1Y3RvciwgUmVzb3VyY2UpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEluaXQgcmVzb3VyY2UgJyR7IGNvbnN0cnVjdG9yLm5hbWUgfScgZXJyb3IuIEBIYXRlb2FzUmVzb3VyY2UgZGVjb3JhdG9yIGFwcGxpZWQgb25seSB0byAnUmVzb3VyY2UnIHR5cGUsIHlvdSB1c2VkIGl0IHdpdGggJHsgT2JqZWN0LmdldFByb3RvdHlwZU9mKGNvbnN0cnVjdG9yKSB9IHR5cGUuYCk7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yW1JFU09VUkNFX05BTUVfUFJPUF0gPSByZXNvdXJjZU5hbWU7XG4gICAgUmVzb3VyY2VVdGlscy5SRVNPVVJDRV9OQU1FX1RZUEVfTUFQLnNldChyZXNvdXJjZU5hbWUudG9Mb3dlckNhc2UoKSwgY29uc3RydWN0b3IpO1xuXG4gICAgaWYgKCFvcHRpb25zPy5yb3V0ZU5hbWUpIHtcbiAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgIHJvdXRlTmFtZTogREVGQVVMVF9ST1VURV9OQU1FXG4gICAgICB9O1xuICAgIH1cbiAgICBjb25zdHJ1Y3RvcltSRVNPVVJDRV9PUFRJT05TX1BST1BdID0gb3B0aW9ucztcblxuICAgIHJldHVybiBjb25zdHJ1Y3RvcjtcbiAgfTtcbn1cblxuLyoqXG4gKiBEZWNvcmF0b3IgdXNlZCB0byBjbGFzc2VzIHRoYXQgZXh0ZW5kIHtAbGluayBFbWJlZGRlZFJlc291cmNlfSBjbGFzcyB0byByZWdpc3RlciAncmVsYXRpb25OYW1lcycgYW5kICdyZXNvdXJjZVR5cGUnXG4gKiBpbmZvcm1hdGlvbiBhYm91dCB0aGlzIHJlc291cmNlLlxuICpcbiAqIEBwYXJhbSByZWxhdGlvbk5hbWVzIG5hbWVzIG9mIHRoZSBwcm9wZXJ0aWVzIHRoYXQgdXNpbmcgdG8gaG9sZCB0aGlzIGVtYmVkZGVkIHJlc291cmNlIGluIHJlc291cmNlIG9iamVjdHMuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBIYXRlb2FzRW1iZWRkZWRSZXNvdXJjZShyZWxhdGlvbk5hbWVzOiBBcnJheTxzdHJpbmc+KSB7XG4gIHJldHVybiA8VCBleHRlbmRzIG5ldyguLi5hcmdzOiBhbnlbXSkgPT4gYW55Pihjb25zdHJ1Y3RvcjogVCkgPT4ge1xuICAgIGlmIChpc051bGwocmVsYXRpb25OYW1lcylcbiAgICAgIHx8IGlzVW5kZWZpbmVkKHJlbGF0aW9uTmFtZXMpXG4gICAgICB8fCAoaXNBcnJheShyZWxhdGlvbk5hbWVzKSAmJiBpc0VtcHR5KHJlbGF0aW9uTmFtZXMpKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbml0IHJlc291cmNlICckeyBjb25zdHJ1Y3Rvci5uYW1lIH0nIGVycm9yLiBASGF0ZW9hc0VtYmVkZGVkUmVzb3VyY2UgZGVjb3JhdG9yIHBhcmFtIHJlbGF0aW9uTmFtZXMgY2FuIG5vdCBiZSBudWxsL3VuZGVmaW5lZC9lbXB0eSwgcGxlYXNlIHBhc3MgYSB2YWxpZCByZWxhdGlvbk5hbWVzLmApO1xuICAgIH1cblxuICAgIGlmICghaXNJbnN0YW5jZU9mUGFyZW50KGNvbnN0cnVjdG9yLCBFbWJlZGRlZFJlc291cmNlKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbml0IHJlc291cmNlICckeyBjb25zdHJ1Y3Rvci5uYW1lIH0nIGVycm9yLiBASGF0ZW9hc0VtYmVkZGVkUmVzb3VyY2UgZGVjb3JhdG9yIGFwcGxpZWQgb25seSB0byAnRW1iZWRkZWRSZXNvdXJjZScgdHlwZSwgeW91IHVzZWQgaXQgd2l0aCAkeyBPYmplY3QuZ2V0UHJvdG90eXBlT2YoY29uc3RydWN0b3IpIH0gdHlwZS5gKTtcbiAgICB9XG4gICAgcmVsYXRpb25OYW1lcy5mb3JFYWNoKHJlbGF0aW9uTmFtZSA9PiB7XG4gICAgICBSZXNvdXJjZVV0aWxzLkVNQkVEREVEX1JFU09VUkNFX1RZUEVfTUFQLnNldChyZWxhdGlvbk5hbWUsIGNvbnN0cnVjdG9yKTtcbiAgICB9KTtcbiAgfTtcbn1cblxuLyoqXG4gKiBEZWNvcmF0b3IgdXNlZCB0byBjcmVhdGUgYSBwcm9qZWN0aW9uIHJlcHJlc2VudGF0aW9uIG9mIHtAbGluayBSZXNvdXJjZX0gaGVpcnMuXG4gKlxuICogQHBhcmFtIHJlc291cmNlVHlwZSB0eXBlIG9mIHJlc291cmNlIHRoYXQgdXNpbmcgZm9yIHByb2plY3Rpb24uXG4gKiBAcGFyYW0gcHJvamVjdGlvbk5hbWUgbmFtZSBvZiBwcm9qZWN0aW9uLCB3aWxsIGJlIHVzZWQgYXMgcHJvamVjdGlvbiByZXF1ZXN0IHBhcmFtLlxuICovXG5leHBvcnQgZnVuY3Rpb24gSGF0ZW9hc1Byb2plY3Rpb24ocmVzb3VyY2VUeXBlOiBuZXcoKSA9PiBSZXNvdXJjZSwgcHJvamVjdGlvbk5hbWU6IHN0cmluZykge1xuICByZXR1cm4gPFQgZXh0ZW5kcyBuZXcoLi4uYXJnczogYW55W10pID0+IGFueT4oY29uc3RydWN0b3I6IFQpID0+IHtcbiAgICBpZiAoaXNOdWxsKHJlc291cmNlVHlwZSkgfHwgaXNVbmRlZmluZWQocmVzb3VyY2VUeXBlKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbml0IHJlc291cmNlIHByb2plY3Rpb24gJyR7IGNvbnN0cnVjdG9yLm5hbWUgfScgZXJyb3IuIEBIYXRlb2FzUHJvamVjdGlvbiBkZWNvcmF0b3IgcGFyYW0gcmVzb3VyY2VUeXBlIGNhbiBub3QgYmUgbnVsbC91bmRlZmluZWQsIHBsZWFzZSBwYXNzIGEgdmFsaWQgcmVzb3VyY2VUeXBlLmApO1xuICAgIH1cbiAgICBpZiAoaXNOdWxsKHByb2plY3Rpb25OYW1lKSB8fCBpc1VuZGVmaW5lZChwcm9qZWN0aW9uTmFtZSkgfHwgIXByb2plY3Rpb25OYW1lKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEluaXQgcmVzb3VyY2UgcHJvamVjdGlvbiAnJHsgY29uc3RydWN0b3IubmFtZSB9JyBlcnJvci4gQEhhdGVvYXNQcm9qZWN0aW9uIGRlY29yYXRvciBwYXJhbSBwcm9qZWN0aW9uTmFtZSBjYW4gbm90IGJlIG51bGwvdW5kZWZpbmVkL2VtcHR5LCBwbGVhc2UgcGFzcyBhIHZhbGlkIHByb2plY3Rpb25OYW1lLmApO1xuICAgIH1cblxuICAgIGlmICghaXNJbnN0YW5jZU9mUGFyZW50KGNvbnN0cnVjdG9yLCBSZXNvdXJjZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgSW5pdCByZXNvdXJjZSBwcm9qZWN0aW9uICckeyBjb25zdHJ1Y3Rvci5uYW1lIH0nIGVycm9yLiBASGF0ZW9hc1Byb2plY3Rpb24gZGVjb3JhdG9yIGFwcGxpZWQgb25seSB0byAnUmVzb3VyY2UnIHR5cGUsIHlvdSB1c2VkIGl0IHdpdGggJHsgT2JqZWN0LmdldFByb3RvdHlwZU9mKGNvbnN0cnVjdG9yKSB9IHR5cGUuYCk7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yW1JFU09VUkNFX05BTUVfUFJPUF0gPSByZXNvdXJjZVR5cGVbUkVTT1VSQ0VfTkFNRV9QUk9QXTtcbiAgICBjb25zdHJ1Y3RvcltSRVNPVVJDRV9PUFRJT05TX1BST1BdID0gcmVzb3VyY2VUeXBlW1JFU09VUkNFX09QVElPTlNfUFJPUF07XG4gICAgY29uc3RydWN0b3JbJ19fcHJvamVjdGlvbk5hbWVfXyddID0gcHJvamVjdGlvbk5hbWU7XG4gICAgUmVzb3VyY2VVdGlscy5SRVNPVVJDRV9OQU1FX1BST0pFQ1RJT05fVFlQRV9NQVAuc2V0KHJlc291cmNlVHlwZVtSRVNPVVJDRV9OQU1FX1BST1BdLnRvTG93ZXJDYXNlKCksIGNvbnN0cnVjdG9yKTtcblxuICAgIHJldHVybiBjb25zdHJ1Y3RvcjtcbiAgfTtcbn1cblxuLyoqXG4gKiBEZWNvcmF0b3IgdXNlZCB0byBtYXJrIHByb2plY3Rpb24gY2xhc3MgcHJvcGVydGllcyB0aGF0IGFyZSByZXNvdXJjZXMgYW5kIHNwZWNpZnlpbmcgY2xhc3MgdHlwZSB1c2VkIHRvIGNyZWF0ZSB0aGlzIHJlbGF0aW9uLlxuICogVGhpcyBkZWNvcmF0b3IgdXNlZCB3aXRoIGNsYXNzIG1hcmtlZCBhcyB7QGxpbmsgSGF0ZW9hc1Byb2plY3Rpb259LlxuICpcbiAqIEBwYXJhbSByZWxhdGlvblR5cGUgcmVzb3VyY2UgcmVsYXRpb24gdHlwZSB0aGF0IHdpbGwgYmUgdXNlZCB0byBjcmVhdGUgcmVzb3VyY2Ugd2l0aCB0aGlzIHR5cGUgd2hlbiBwYXJzZWQgc2VydmVyIHJlc3BvbnNlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gUHJvamVjdGlvblJlbChyZWxhdGlvblR5cGU6IG5ldygpID0+IEJhc2VSZXNvdXJjZSkge1xuICByZXR1cm4gKHRhcmdldDogb2JqZWN0LCBwcm9wZXJ0eUtleTogc3RyaW5nKSA9PiB7XG4gICAgaWYgKGlzTnVsbChyZWxhdGlvblR5cGUpIHx8IGlzVW5kZWZpbmVkKHJlbGF0aW9uVHlwZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgSW5pdCByZXNvdXJjZSBwcm9qZWN0aW9uICckeyB0YXJnZXQuY29uc3RydWN0b3IubmFtZSB9JyByZWxhdGlvbiB0eXBlIGVycm9yLiBAUHJvamVjdGlvblJlbCBkZWNvcmF0b3IgcGFyYW0gcmVsYXRpb25UeXBlIGNhbiBub3QgYmUgbnVsbC91bmRlZmluZWQsIHBsZWFzZSBwYXNzIGEgdmFsaWQgcmVsYXRpb25UeXBlLmApO1xuICAgIH1cblxuICAgIFJlc291cmNlVXRpbHMuUkVTT1VSQ0VfUFJPSkVDVElPTl9SRUxfTkFNRV9UWVBFX01BUC5zZXQocHJvcGVydHlLZXksIHJlbGF0aW9uVHlwZSk7XG4gIH07XG59XG5cblxuZnVuY3Rpb24gaXNJbnN0YW5jZU9mUGFyZW50KGNvbnN0cnVjdG9yOiBuZXcgKC4uLmFyZ3M6IGFueVtdKSA9PiBhbnksIHBhcmVudENsYXNzOiBhbnkpIHtcbiAgaWYgKE9iamVjdC5nZXRQcm90b3R5cGVPZihjb25zdHJ1Y3RvcikubmFtZSA9PT0gJycpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgaWYgKE9iamVjdC5nZXRQcm90b3R5cGVPZihjb25zdHJ1Y3RvcikgPT09IHBhcmVudENsYXNzKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICByZXR1cm4gaXNJbnN0YW5jZU9mUGFyZW50KE9iamVjdC5nZXRQcm90b3R5cGVPZihjb25zdHJ1Y3RvciksIHBhcmVudENsYXNzKTtcbn1cbiJdfQ==